---

auth:
  enabled: false
  rootPassword: mdbrootpass

architecture: replicaset

replicaCount: 3
replicaSetName: rs0
replicaSetHostnames: true

podAnnotations: {}

metrics:
  enabled: true
  containerPort: 9216
  service:
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "{{ .Values.metrics.service.port }}"
      prometheus.io/path: "/metrics"
    type: ClusterIP
    port: 9216
  serviceMonitor:
    enabled: true
    namespace: monitoring
    additionalLabels:
      # https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack#prometheusioscrape
      release: prometheus
  prometheusRule:
    enabled: true
    namespace: monitoring
    additionalLabels:
      release: prometheus
    rules:
      - name: mongodb
        rules:
          - alert: MongodbDown
            expr: mongodb_up == 0
            for: 0m
            labels:
              severity: critical
            annotations:
              summary: MongoDB Down (instance {{`{{ $labels.instance }}`}})
              description: |
                MongoDB instance is down
                VALUE = {{`{{ $value }}`}}
                LABELS: {{`{{ $labels }}`}}
          - alert: MongodbReplicationLag
            expr: mongodb_mongod_replset_member_optime_date{state="PRIMARY"} - ON (set) mongodb_mongod_replset_member_optime_date{state="SECONDARY"} > 10
            for: 0m
            labels:
              severity: critical
            annotations:
              summary: MongoDB replication lag (instance {{`{{ $labels.instance }}`}})
              description: |
                Mongodb replication lag is more than 10s
                VALUE = {{`{{ $value }}`}}
                LABELS: {{`{{ $labels }}`}}
