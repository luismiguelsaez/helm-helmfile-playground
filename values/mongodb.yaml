---

auth:
  enabled: false
  rootPassword: mdbrootpass

architecture: replicaset

replicaCount: 3
replicaSetName: rs0
replicaSetHostnames: true

podAnnotations: {}

metrics:
  enabled: true
  containerPort: 9216
  service:
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "{{ .Values.metrics.service.port }}"
      prometheus.io/path: "/metrics"
    type: ClusterIP
    port: 9216
  serviceMonitor:
    enabled: true
    namespace: monitoring
    additionalLabels:
      # https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack#prometheusioscrape
      release: prometheus
  prometheusRule:
    enabled: true
    namespace: monitoring
    additionalLabels:
      release: prometheus
    rules:
      - name: mongodb
        rules:
          - alert: InstanceUp
            expr: mongodb_up{job="mongodb-metrics",state="active"} < 1
            for: 1m
            labels:
              severity: critical
            annotations:
              message: |
                Instance down
          - alert: HighActiveConnectionCount
            expr: mongodb_connections{job="mongodb-metrics",state="active"} > 1000
            for: 10m
            labels:
              severity: warning
            annotations:
              message: |
                High active connection count, check nodes for slowqueries
          - alert: MetricsWTimeouts
            expr: mongodb_mongod_metrics_get_last_error_wtimeouts_total{job="mongodb-metrics"} > 0
            for: 10m
            labels:
              severity: warning
            annotations:
              message: |
                Timeouts while getting metrics, check mongodb instance